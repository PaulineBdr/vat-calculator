<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>VAT Calculator</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        // Lucide Icons as inline SVGs
        const Upload = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="17 8 12 3 7 8"></polyline>
                <line x1="12" y1="3" x2="12" y2="15"></line>
            </svg>
        );

        const Download = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
        );

        const FileText = () => (
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                <polyline points="14 2 14 8 20 8"></polyline>
                <line x1="16" y1="13" x2="8" y2="13"></line>
                <line x1="16" y1="17" x2="8" y2="17"></line>
                <polyline points="10 9 9 9 8 9"></polyline>
            </svg>
        );

        function VATCalculator() {
            const [data, setData] = useState([]);
            const [fileName, setFileName] = useState('');
            const [error, setError] = useState('');
            const [vatRateAppointment, setVatRateAppointment] = useState(20);
            const [vatRateProductSale, setVatRateProductSale] = useState(10);

            const handleFileUpload = (event) => {
                const file = event.target.files[0];
                if (!file) return;

                setFileName(file.name);
                setError('');

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const text = e.target.result;
                        const lines = text.split('\n');
                        const headers = lines[0].split(',').map(h => h.trim());
                        
                        const parsedData = [];
                        for (let i = 1; i < lines.length; i++) {
                            if (!lines[i].trim()) continue;
                            
                            const values = [];
                            let current = '';
                            let inQuotes = false;
                            
                            for (let char of lines[i]) {
                                if (char === '"') {
                                    inQuotes = !inQuotes;
                                } else if (char === ',' && !inQuotes) {
                                    values.push(current.trim());
                                    current = '';
                                } else {
                                    current += char;
                                }
                            }
                            values.push(current.trim());
                            
                            const row = {};
                            headers.forEach((header, index) => {
                                row[header] = values[index] || '';
                            });
                            
                            // Calculate VAT based on transaction type
                            const transaction = row.transaction?.toLowerCase() || '';
                            const grossValue = parseFloat(row.gross_value) || 0;
                            
                            if (transaction === 'appointment') {
                                row.vat_amount = (grossValue * (vatRateAppointment / 100)).toFixed(2);
                                row.vat_rate = vatRateAppointment;
                            } else if (transaction === 'product_sale') {
                                row.vat_amount = (grossValue * (vatRateProductSale / 100)).toFixed(2);
                                row.vat_rate = vatRateProductSale;
                            } else {
                                row.vat_amount = '';
                                row.vat_rate = '';
                            }
                            
                            parsedData.push(row);
                        }
                        
                        setData(parsedData);
                    } catch (err) {
                        setError('Error reading file: ' + err.message);
                    }
                };
                
                reader.readAsText(file);
            };

            const downloadCSV = () => {
                if (data.length === 0) return;
                
                const headers = ['payment', 'Heure et jour', 'transaction', 'type', 'gross_value', 
                                'VAT Rate', 'VAT Amount', 'shop', 'employee', 'customer_name', 'additional_info',
                                'bank_account', 'online_payment_arrival', 'online_payment_fee', 'url'];
                
                let csv = headers.join(',') + '\n';
                
                data.forEach(row => {
                    const escapeCSV = (str) => {
                        if (!str) return '';
                        const stringValue = String(str);
                        if (stringValue.includes(',') || stringValue.includes('"') || stringValue.includes('\n')) {
                            return `"${stringValue.replace(/"/g, '""')}"`;
                        }
                        return stringValue;
                    };
                    
                    const values = [
                        escapeCSV(row.payment),
                        escapeCSV(row['Heure et jour']),
                        escapeCSV(row.transaction),
                        escapeCSV(row.type),
                        escapeCSV(row.gross_value),
                        escapeCSV(row.vat_rate ? row.vat_rate + '%' : ''),
                        escapeCSV(row.vat_amount),
                        escapeCSV(row.shop),
                        escapeCSV(row.employee),
                        escapeCSV(row.customer_name),
                        escapeCSV(row.additional_info),
                        escapeCSV(row.bank_account),
                        escapeCSV(row.online_payment_arrival),
                        escapeCSV(row.online_payment_fee),
                        escapeCSV(row.url)
                    ];
                    csv += values.join(',') + '\n';
                });
                
                const BOM = '\uFEFF';
                const blob = new Blob([BOM + csv], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                const newFileName = fileName.replace('.csv', '') + '_with_VAT.csv';
                link.download = newFileName;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
            };

            const formatCurrency = (value) => {
                if (!value) return '-';
                const num = parseFloat(value);
                return num.toFixed(2) + ' ‚Ç¨';
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-8">
                    <div className="max-w-7xl mx-auto">
                        <div className="bg-white rounded-lg shadow-lg p-8 mb-6">
                            <div className="flex items-center gap-3 mb-6">
                                <FileText />
                                <h1 className="text-3xl font-bold text-gray-800">VAT Calculator</h1>
                            </div>
                            
                            <p className="text-gray-600 mb-6">
                                Import your payment CSV file to automatically calculate VAT with different rates based on transaction type.
                            </p>

                            <div className="mb-6 bg-indigo-50 border border-indigo-200 rounded-lg p-4">
                                <h3 className="text-lg font-semibold text-indigo-900 mb-4">VAT Rates by Transaction Type</h3>
                                
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div className="bg-white rounded-lg p-4 border border-indigo-200">
                                        <label className="block text-sm font-semibold text-green-800 mb-3">
                                            üìÖ Appointment
                                        </label>
                                        <div className="flex gap-2 mb-3">
                                            <button
                                                onClick={() => setVatRateAppointment(5.5)}
                                                className={`px-3 py-2 rounded-lg text-sm font-medium transition-colors ${
                                                    vatRateAppointment === 5.5
                                                        ? 'bg-green-600 text-white'
                                                        : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                                                }`}
                                            >
                                                5.5%
                                            </button>
                                            <button
                                                onClick={() => setVatRateAppointment(10)}
                                                className={`px-3 py-2 rounded-lg text-sm font-medium transition-colors ${
                                                    vatRateAppointment === 10
                                                        ? 'bg-green-600 text-white'
                                                        : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                                                }`}
                                            >
                                                10%
                                            </button>
                                            <button
                                                onClick={() => setVatRateAppointment(20)}
                                                className={`px-3 py-2 rounded-lg text-sm font-medium transition-colors ${
                                                    vatRateAppointment === 20
                                                        ? 'bg-green-600 text-white'
                                                        : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                                                }`}
                                            >
                                                20%
                                            </button>
                                        </div>
                                        <div className="flex items-center gap-2">
                                            <span className="text-sm text-gray-700">Custom:</span>
                                            <input
                                                type="number"
                                                min="0"
                                                max="100"
                                                step="0.1"
                                                value={vatRateAppointment}
                                                onChange={(e) => setVatRateAppointment(parseFloat(e.target.value) || 0)}
                                                className="w-20 px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-green-500"
                                            />
                                            <span className="text-sm text-gray-700">%</span>
                                        </div>
                                    </div>

                                    <div className="bg-white rounded-lg p-4 border border-indigo-200">
                                        <label className="block text-sm font-semibold text-blue-800 mb-3">
                                            üõçÔ∏è Product Sale
                                        </label>
                                        <div className="flex gap-2 mb-3">
                                            <button
                                                onClick={() => setVatRateProductSale(5.5)}
                                                className={`px-3 py-2 rounded-lg text-sm font-medium transition-colors ${
                                                    vatRateProductSale === 5.5
                                                        ? 'bg-blue-600 text-white'
                                                        : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                                                }`}
                                            >
                                                5.5%
                                            </button>
                                            <button
                                                onClick={() => setVatRateProductSale(10)}
                                                className={`px-3 py-2 rounded-lg text-sm font-medium transition-colors ${
                                                    vatRateProductSale === 10
                                                        ? 'bg-blue-600 text-white'
                                                        : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                                                }`}
                                            >
                                                10%
                                            </button>
                                            <button
                                                onClick={() => setVatRateProductSale(20)}
                                                className={`px-3 py-2 rounded-lg text-sm font-medium transition-colors ${
                                                    vatRateProductSale === 20
                                                        ? 'bg-blue-600 text-white'
                                                        : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                                                }`}
                                            >
                                                20%
                                            </button>
                                        </div>
                                        <div className="flex items-center gap-2">
                                            <span className="text-sm text-gray-700">Custom:</span>
                                            <input
                                                type="number"
                                                min="0"
                                                max="100"
                                                step="0.1"
                                                value={vatRateProductSale}
                                                onChange={(e) => setVatRateProductSale(parseFloat(e.target.value) || 0)}
                                                className="w-20 px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            />
                                            <span className="text-sm text-gray-700">%</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div className="flex gap-4 mb-6">
                                <label className="flex-1 cursor-pointer">
                                    <div className="flex items-center justify-center gap-2 bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-3 rounded-lg transition-colors">
                                        <Upload />
                                        <span>Load CSV File</span>
                                    </div>
                                    <input
                                        type="file"
                                        accept=".csv"
                                        onChange={handleFileUpload}
                                        className="hidden"
                                    />
                                </label>

                                {data.length > 0 && (
                                    <button
                                        onClick={downloadCSV}
                                        className="flex items-center gap-2 bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg transition-colors"
                                    >
                                        <Download />
                                        <span>Download with VAT</span>
                                    </button>
                                )}
                            </div>

                            {fileName && (
                                <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                                    <p className="text-blue-800">
                                        <strong>File loaded:</strong> {fileName}
                                        {data.length > 0 && ` (${data.length} rows)`}
                                    </p>
                                </div>
                            )}

                            {error && (
                                <div className="bg-red-50 border border-red-200 rounded-lg p-4 mb-6">
                                    <p className="text-red-800">{error}</p>
                                </div>
                            )}
                        </div>

                        {data.length > 0 && (
                            <div className="bg-white rounded-lg shadow-lg overflow-hidden">
                                <div className="overflow-x-auto">
                                    <table className="w-full">
                                        <thead className="bg-indigo-600 text-white">
                                            <tr>
                                                <th className="px-4 py-3 text-left text-sm font-semibold">ID</th>
                                                <th className="px-4 py-3 text-left text-sm font-semibold">Date & Time</th>
                                                <th className="px-4 py-3 text-left text-sm font-semibold">Transaction</th>
                                                <th className="px-4 py-3 text-left text-sm font-semibold">Type</th>
                                                <th className="px-4 py-3 text-right text-sm font-semibold">Gross Value</th>
                                                <th className="px-4 py-3 text-center text-sm font-semibold">VAT Rate</th>
                                                <th className="px-4 py-3 text-right text-sm font-semibold">VAT Amount</th>
                                                <th className="px-4 py-3 text-left text-sm font-semibold">Employee</th>
                                                <th className="px-4 py-3 text-left text-sm font-semibold">Customer</th>
                                                <th className="px-4 py-3 text-left text-sm font-semibold">Add. Info</th>
                                                <th className="px-4 py-3 text-left text-sm font-semibold">Bank Acc.</th>
                                                <th className="px-4 py-3 text-left text-sm font-semibold">Payment Arr.</th>
                                                <th className="px-4 py-3 text-left text-sm font-semibold">Payment Fee</th>
                                                <th className="px-4 py-3 text-left text-sm font-semibold">URL</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {data.map((row, index) => (
                                                <tr 
                                                    key={index}
                                                    className={`border-b border-gray-200 ${
                                                        index % 2 === 0 ? 'bg-gray-50' : 'bg-white'
                                                    } hover:bg-indigo-50 transition-colors`}
                                                >
                                                    <td className="px-4 py-3 text-sm">{row.payment}</td>
                                                    <td className="px-4 py-3 text-sm">{row['Heure et jour']}</td>
                                                    <td className="px-4 py-3 text-sm">
                                                        <span className={`px-2 py-1 rounded text-xs ${
                                                            row.transaction === 'appointment' ? 'bg-green-100 text-green-800' :
                                                            row.transaction === 'product_sale' ? 'bg-blue-100 text-blue-800' :
                                                            'bg-gray-100 text-gray-800'
                                                        }`}>
                                                            {row.transaction}
                                                        </span>
                                                    </td>
                                                    <td className="px-4 py-3 text-sm">{row.type}</td>
                                                    <td className="px-4 py-3 text-sm text-right font-medium">
                                                        {formatCurrency(row.gross_value)}
                                                    </td>
                                                    <td className="px-4 py-3 text-sm text-center">
                                                        {row.vat_rate && (
                                                            <span className={`px-2 py-1 rounded text-xs font-semibold ${
                                                                row.transaction === 'appointment' 
                                                                    ? 'bg-green-100 text-green-800' 
                                                                    : 'bg-blue-100 text-blue-800'
                                                            }`}>
                                                                {row.vat_rate}%
                                                            </span>
                                                        )}
                                                    </td>
                                                    <td className="px-4 py-3 text-sm text-right font-bold text-indigo-600">
                                                        {row.vat_amount ? formatCurrency(row.vat_amount) : '-'}
                                                    </td>
                                                    <td className="px-4 py-3 text-sm">{row.employee}</td>
                                                    <td className="px-4 py-3 text-sm">{row.customer_name}</td>
                                                    <td className="px-4 py-3 text-sm text-gray-600">{row.additional_info}</td>
                                                    <td className="px-4 py-3 text-sm text-gray-600">{row.bank_account}</td>
                                                    <td className="px-4 py-3 text-sm text-gray-600">{row.online_payment_arrival}</td>
                                                    <td className="px-4 py-3 text-sm text-gray-600">{row.online_payment_fee}</td>
                                                    <td className="px-4 py-3 text-sm">
                                                        {row.url && (
                                                            <a 
                                                                href={row.url} 
                                                                target="_blank" 
                                                                rel="noopener noreferrer"
                                                                className="text-indigo-600 hover:text-indigo-800 underline text-xs"
                                                            >
                                                                Link
                                                            </a>
                                                        )}
                                                    </td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        ReactDOM.render(<VATCalculator />, document.getElementById('root'));
    </script>
</body>
</html>
